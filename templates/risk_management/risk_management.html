{% extends 'base.html' %}
{% load static %}

{% block title %}
<title>Risk Management</title>
{% endblock title %}

{% block stylesheets %}
<link href="{% static 'core/styles/form_card.css' %}" rel="stylesheet">
<link href="{% static 'core/styles/tabs.css' %}" rel="stylesheet">
<link href="{% static 'risk_management/styles/functions_modal.css' %}" rel="stylesheet">
<link href="{% static 'risk_management/styles/risk_management.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}

<!-- Profile Create Modal -->
<div class="modal fade" id="profileCreateModal" style="display: none;" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="border-radius: 2px;">
            <div class="modal-header">
                <h5 class="modal-title">Create Risk Profile</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal">
                </button>
            </div>
            
            <div class="modal-body">
                <form 
                    action="" 
                    method="post" 
                    id="profile-create-form"
                >
                    {% csrf_token %}
    
                    <div class="form-fields">
                        <div class="form-field">
                            <label for="name">Name</label>
                            <input 
                                type="text" 
                                class="form-input form-control input-rounded" 
                                placeholder="Profile name" 
                                id="name"
                                name="name"
                                required
                            >
                            <small class="field-message"></small>
                        </div>

                        <div class="form-field">
                            <label for="description">Description</label>
                            <input 
                                type="text" 
                                class="form-input form-control input-rounded" 
                                placeholder="Profile description"
                                id="description"
                                name="description"
                            >
                            <small class="field-message"></small>
                        </div>

                        <div class="form-field">
                            <label for="criteria">Criteria</label>
                            <input 
                                type="text" 
                                class="form-input form-control input-rounded" 
                                id="criteria"
                                name="criteria"
                                required
                                hidden
                            >
                            <small class="field-message"></small>

                            <div id="criteria-selected">
                                <!-- Selected criteria a displayed here -->
                            </div>

                            <button id="criteria-creation-section-toggle" type="button">New Criteria +</button>

                            {% with operators_schema=criteria_creation_schema.operators_schema functions_schema=criteria_creation_schema.functions_schema %}
                            <div id="criteria-creation-section">
                                <div id="criteria-creation-fields">
                                    <div class="form-fields">
                                        <div class="form-field">
                                            <label for="func1">Function One</label>
                                            <input 
                                                type="text" 
                                                class="form-input form-control input-rounded function-input" 
                                                id="func1"
                                                name="func1"
                                                required
                                                data-options=""
                                                placeholder="Function 1"
                                            >

                                            <!-- Funtions Modal -->
                                            <div class="functions-modal">
                                                <div class="modal-head">
                                                    <div class="head-text">
                                                        <h5>Select a function</h5>

                                                        <button type="button" class="btn-close">
                                                        </button>
                                                    </div>
                                        
                                                    <div class="options-search-wp">
                                                        <i class="fas fa-search"></i>
                                                        <input type="search" class="options-search-input">
                                                    </div>
                                                </div>
                                        
                                                <div class="function-options options">
                                                    {% for function_group, function_group_data in functions_schema.items %}
                                                    <div class="option">
                                                        <div class="option-label">
                                                            <span>{{ function_group }}</span>
                                                            <span class="arrow">&rarr;</span>
                                                        </div>
                                                        
                                                        <div class="sub-options">
                                                            <div class="sub-options-head">
                                                                <span class="arrow">&larr;</span>
                                                                <p>{{ function_group }}</p>
                                                            </div>
                                        
                                                            <div class="options">
                                                                {% for function, function_data in function_group_data.items %}
                                                                <div class="option" data-function="{{ function }}">
                                                                    <div class="option-label" title="{{ function_data.description }}">
                                                                        <span>{{ function }}</span>

                                                                        {% if function_data.kwargs %}
                                                                        <span class="arrow">&rarr;</span>
                                                                        {% endif %}
                                                                    </div>

                                                                    {% if function_data.kwargs %}
                                                                    <div class="sub-options">
                                                                        <div class="sub-options-head">
                                                                            <span class="arrow">&larr;</span>
                                                                            <p>{{ function_data.name }}</p>
                                                                        </div>

                                                                        <div class="options">
                                                                            <div class="form-fields" data-function="{{ function }}">
                                                                                {% for argument, argument_data in function_data.kwargs.arguments.items %}
                                                                                <div class="form-field">
                                                                                    <label for="{{ argument }}">{{ argument | title }}</label>
                                                                                    <input 
                                                                                        type="text" 
                                                                                        class="form-input form-control input-rounded function-input" 
                                                                                        id="{{ argument }}"
                                                                                        name="{{ argument }}"
                                                                                        {% if argument_data.required %}
                                                                                            required
                                                                                        {% endif %}
                                                                                        placeholder="{{ argument | title }}"
                                                                                        title="{{ argument_data.description }}"
                                                                                        value="{{ argument_data.default }}"
                                                                                        data-default="{{ argument_data.default }}"
                                                                                    >
                                                                                </div>
                                                                                {% endfor %}
                                                                                
                                                                                <button 
                                                                                    type="button" 
                                                                                    class="btn light btn-success btn-sm done-btn" 
                                                                                >
                                                                                    Done
                                                                                </button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    {% endif %}
                                                                </div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-field">
                                            <label for="op">Operator</label>
                                            <select name="op" id="op" class="form-input form-select">
                                                {% for operator_name, operator_value in operators_schema.items %}
                                                <option value="{{ operator_value }}">{{ operator_name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                        <div class="form-field">
                                            <label for="func2">Function Two</label>
                                            <input 
                                                type="text" 
                                                class="form-input form-control input-rounded function-input" 
                                                id="func2"
                                                name="func2"
                                                required
                                                data-options=""
                                                placeholder="Function 2"
                                            >

                                            <!-- Funtions Modal -->
                                            <div class="functions-modal">
                                                <div class="modal-head">
                                                    <div class="head-text">
                                                        <h5>Select a function</h5>

                                                        <button type="button" class="btn-close">
                                                        </button>
                                                    </div>
                                        
                                                    <div class="options-search-wp">
                                                        <i class="fas fa-search"></i>
                                                        <input type="search" class="options-search-input">
                                                    </div>
                                                </div>
                                        
                                                <div class="function-options options">
                                                    {% for function_group, function_group_data in functions_schema.items %}
                                                    <div class="option">
                                                        <div class="option-label">
                                                            <span>{{ function_group }}</span>
                                                            <span class="arrow">&rarr;</span>
                                                        </div>
                                                        
                                                        <div class="sub-options">
                                                            <div class="sub-options-head">
                                                                <span class="arrow">&larr;</span>
                                                                <p>{{ function_group }}</p>
                                                            </div>
                                        
                                                            <div class="options">
                                                                {% for function, function_data in function_group_data.items %}
                                                                <div class="option" data-function="{{ function }}">
                                                                    <div class="option-label" title="{{ function_data.description }}">
                                                                        <span>{{ function }}</span>

                                                                        {% if function_data.kwargs %}
                                                                        <span class="arrow">&rarr;</span>
                                                                        {% endif %}
                                                                    </div>

                                                                    {% if function_data.kwargs %}
                                                                    <div class="sub-options">
                                                                        <div class="sub-options-head">
                                                                            <span class="arrow">&larr;</span>
                                                                            <p>{{ function_data.name }}</p>
                                                                        </div>

                                                                        <div class="options">
                                                                            <div class="form-fields" data-function="{{ function }}">
                                                                                {% for argument, argument_data in function_data.kwargs.arguments.items %}
                                                                                <div class="form-field">
                                                                                    <label for="{{ argument }}">{{ argument | title }}</label>
                                                                                    <input 
                                                                                        type="text" 
                                                                                        class="form-input form-control input-rounded function-input" 
                                                                                        id="{{ argument }}"
                                                                                        name="{{ argument }}"
                                                                                        {% if argument_data.required %}
                                                                                            required
                                                                                        {% endif %}
                                                                                        placeholder="{{ argument | title }}"
                                                                                        title="{{ argument_data.description }}"
                                                                                        value="{{ argument_data.default }}"
                                                                                        data-default="{{ argument_data.default }}"
                                                                                    >
                                                                                </div>
                                                                                {% endfor %}
                                                                                
                                                                                <button 
                                                                                    type="button" 
                                                                                    class="btn light btn-success btn-sm done-btn" 
                                                                                >
                                                                                    Done
                                                                                </button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    {% endif %}
                                                                </div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <button type="button" class="btn light btn-success btn-sm add-btn">Add</button>
                                </div>
                            </div>
                            {% endwith %}

                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="submit" class="btn light btn-success btn-sm submit-btn">Create</button>
                        <button type="button" class="btn btn-danger light btn-sm" data-bs-dismiss="modal">Close</button>
                    </div>
                </form>       
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h4 class="card-title">Risk Profiles</h4>

                <button 
                    type="button" 
                    class="btn btn-light btn-sm"
                    data-bs-toggle="modal"
                    data-bs-target="#profileCreateModal"
                >
                    Create Profile
                </button>
            </div>
            
            <section class="tabs-section p-4" id="risk-profile-tabs-section" data-urlparam="profile">
                <nav class="tab-toggles-wp">
                    <ul class="pagination pagination-lg pagination-gutter pagination-success tab-toggles-wp-inner">
                        <li class="page-item active tab-toggle" data-tabtarget="transaction-history">
                            <button class="page-link" style="border-radius: 4px !important;">Profile 1</button>
                        </li>
                        <li class="page-item tab-toggle" data-tabtarget="stocks-summary">
                            <button class="page-link" style="border-radius: 4px !important;">Profile 2</button>
                        </li>
                    </ul>
                </nav> 
                
                <div class="tabs">
                    <!-- Transactions Tab -->
                    <div class="col-12 tab" id="transaction-history">
                        <div class="card" style="border-radius: 0;">
                            <div class="card-header">
                                <h4 class="card-title">Profile 1</h4>
        
                                <button 
                                    type="button" 
                                    class="btn btn-light btn-sm"
                                    data-bs-toggle="modal"
                                    data-bs-target="#transactionAddModal"
                                >
                                    Edit Profile
                                </button>
                            </div>
                            <div class="card-body" style="display: flex; flex-direction: column; gap: 12px;">
        
                            <!-- Table goes here -->
                            </div>
                        </div>
                    </div>
        
                    <!-- Stocks Summary Tab -->
                    <div class="col-12 tab" id="stocks-summary">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title">Profile 2</h4>
                            </div>
                            <div class="card-body">
                                <!-- Table goes here -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>
{% endblock %}


{% block scripts %}
<script src="{% static 'core//scripts//formCard.js' %}"></script>
<script src="{% static 'core//scripts//tabs.js' %}"></script>
<script src="{% static 'risk_management//scripts//functionsModal.js' %}"></script>
<script src="{% static 'risk_management//scripts//riskProfileCreate.js' %}"></script>
{% endblock %}
